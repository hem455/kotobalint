# 技術設計: 日本語文書校正支援（document-proofreading）

## アーキテクチャ概要
- 形態: ローカルWebアプリ（ローカルサーバ + ブラウザUI、またはデスクトップラッパー）
- コア: JavaScript/TypeScript ベースの校正エンジン（textlint中心に拡張）
- UI: ブラウザで動作するエディタ + 指摘一覧 + 設定画面
- データ: 設定・辞書・無視リストはローカルファイルに保存（プロジェクト単位の上書き）

## コンポーネント構成
1) 校正エンジン層
   - Textlintランタイム: textlint 本体、ルールローダ、プリセット管理
   - ルールセット: 日本語向けプリセット + プロジェクトカスタムルール
   - 形態素解析（オプション）: Kuromoji/Sudachi を用いた品詞情報の付与
   - スペル/用語辞書: カスタム辞書・ユーザー辞書の読み込み
   - Fixer: 自動修正を安全に適用するモジュール

2) アプリケーション層（API）
   - `POST /lint`: テキスト/ファイルを受け取り、診断結果（指摘・位置・ルール・重大度・fix候補）を返却
   - `POST /fix`: 指摘に基づく自動修正の適用（選択的・一括）
   - `GET /rules`: 有効ルールと設定の取得
   - `PUT /rules`: ルール設定の更新（ON/OFF、重大度、閾値）
   - `GET /dictionary`: 辞書/用語集の取得
   - `PUT /dictionary`: 辞書の更新（語彙追加・削除）
   - `PUT /ignore`: 無視リストの登録/解除（ルール・範囲・ファイル単位）

3) プレゼンテーション層（UI）
   - エディタ: 入力（貼り付け/ファイル）と行/文単位のハイライト
   - 指摘パネル: 重大度・ルールでフィルタ、ジャンプ、修正適用
   - 差分ビュー: 原文と修正案の比較
   - 設定画面: ルール、辞書、プロジェクト設定の編集

## 技術選択（候補と方針）
- ランタイム: Node.js（オフライン・クロスプラットフォーム・textlintとの親和性）
- 校正基盤: textlint + 日本語ルール群（例: textlint-rule-preset-japanese）
- 形態素解析: kuromoji.js or Sudachi（必要なルールのみで使用して軽量化）
- フロントエンド: シンプルなSPA（React/Vite など）または軽量ビューライブラリ
- デスクトップ化（任意）: Tauri/Electron（後続フェーズ）

## ルール設計ガイド
- 重大度レベル: error/warn/info を統一運用
- 固定長・閾値: 句読点距離、連続助詞、同一語の過剰反復など
- 表記統一: 全角/半角、カタカナ/ひらがな、英記号の扱い
- ドメイン辞書: 製品名・固有名詞・禁則語のカスタム辞書
- 自動修正の安全性: 文意を変えない置換のみfix対象にする

## データモデル（サマリ）
- RuleConfig: `id`, `level`, `options`（各ルール固有の設定）
- Finding: `id`, `ruleId`, `message`, `range`, `severity`, `suggest`, `fix`（任意）
- DictionaryEntry: `term`, `variant`, `preferred`, `notes`
- ProjectConfig: ルール集合、辞書、無視リスト、対象ファイルパターン

## パフォーマンス戦略
- 文書分割（段落/文単位）+ 並列化（Web Worker/Node worker）
- 差分リンティング（前回結果と差分箇所のみ再解析）
- キャッシュ（辞書・トークナイズ結果）

## セキュリティ・プライバシー
- 外部送信なし（ネットワーク呼び出しを行わない設計）
- ローカルファイルへのアクセスはユーザー操作に限定
- 設定・辞書はプレーンテキストで保存し、プロジェクトごとに分離

## テレメトリ/ログ（任意）
- 既定は無効。ユーザー明示許可時のみ匿名統計を保存（完全ローカル）

## 実装フェーズ計画（MVP）
1. textlint をコアに据えたCLI/API基盤の確立
2. 代表的な日本語ルールプリセットの同梱と設定UI
3. エディタ+指摘一覧+fix適用の最短導線を提供
4. プロジェクト設定/辞書/無視リストの永続化
5. パフォーマンス最適化（差分処理・簡易キャッシュ）
