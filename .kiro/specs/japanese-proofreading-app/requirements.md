# 要件定義書

## 概要

本文書は、日本語文書校正支援アプリケーションの要件を定義します。このアプリケーションは、誤字・表記ゆれ・冗長表現・敬語誤用・スタイル違反を自動検出するローカルWebアプリケーションです。ルールベース検出（確実・安定）とLLM提案（文脈・読みやすさ重視）を組み合わせ、5秒以内に理由付きの修正案を提示し、ワンクリックで適用できる機能を提供します。

## 要件

### 要件1: コアテキスト解析エンジン

**ユーザーストーリー:** コンテンツ作成者として、日本語テキストを入力して自動校正解析を受けたい。そうすることで、文章の問題を素早く特定し修正できる。

#### 受け入れ基準

1. ユーザーが20,000文字以内のテキストを入力した時、システムはエラーなくテキストを処理する
2. テキストが20,000文字を超えた時、システムは段落ごとの解析提案と共に警告メッセージを表示する
3. ユーザーが解析を実行した時、システムは2000文字に対して5秒以内に結果を返す（P95、LLM提案OFF時）
4. 解析が完了した時、システムはテキスト内の問題箇所を下線でハイライト表示する
5. ユーザーが自動解析を有効にした場合、システムは入力停止から500ms後に解析を実行する

### 要件2: ルールベース検出システム

**ユーザーストーリー:** ライターとして、信頼できるルールを使って一般的な日本語の文章問題を検出したい。そうすることで、一貫性のある正しい文体を維持できる。

#### 受け入れ基準

1. テキストを解析する時、システムは表記ゆれを検出する（コンピュータ/コンピューター、全角/半角、ひらがな/カタカナ、英数字の統一）
2. テキストを解析する時、システムは文法エラーを検出する（ら抜き言葉、二重否定）
3. テキストを解析する時、システムは冗長表現を検出する（〜することができる→〜できる、まず最初に→まず）
4. テキストを解析する時、システムは敬語誤用を検出する（「お伺いさせていただく」などの二重敬語）
5. テキストを解析する時、システムはスタイルガイド違反を検出する（60文字超の文、読点の過不足）
6. テキストを解析する時、システムは連続使用の問題を検出する（助詞の連続、同一語の過度な反復）
7. テキストを解析する時、システムはリスク表現（断定的主張、比較優位）を警告のみでフラグ付けする
8. ルールベース解析が完了した時、システムはゴールド標準文書（50段落）でF1スコア≥0.70を達成する

### 要件3: LLM支援提案

**ユーザーストーリー:** 編集者として、ルールでは検出できない読みやすさや文脈的改善についてAI支援の提案が欲しい。そうすることで、基本的な修正を超えてテキスト品質を向上できる。

#### 受け入れ基準

1. LLM提案が有効な時、システムは読みやすさ、主語の明確性、冗長な文の分割について解析する
2. LLM提案を生成する時、システムは理由付き（各80文字以内）で最大3つの修正選択肢を提供する
3. LLM提案を生成する時、システムは断定的でない表現を使用する（「望ましい」「恐れがある」）
4. LLMに送信する時、システムは対象文±前後1文のみを文脈として送信する
5. LLM解析が完了する時、システムは1リクエストあたり1.5-3.0秒以内に完了する（10秒タイムアウト）

### 要件4: 問題表示・管理

**ユーザーストーリー:** ユーザーとして、検出されたすべての問題を詳細な説明付きで整理されたリストで見たい。そうすることで、内容を理解して選択的に修正を適用できる。

#### 受け入れ基準

1. 解析が完了した時、システムはサイドパネルのリストに問題を表示する
2. ユーザーが問題を選択した時、システムは右詳細パネルに内容、理由、修正提案を表示する
3. 問題を表示する時、システムは種別（ルール/LLM）、重要度（info/warn/error）、カテゴリで分類する
4. ユーザーが「適用」をクリックした時、システムはその特定の修正をテキストに即座に反映する
5. ユーザーが「安全な一括修正」をクリックした時、システムは意味変化リスクゼロの安全な置換のみを適用する
6. 問題を表示する時、システムはルール/LLM種別、重要度、カテゴリでフィルタリングを可能にする
7. 修正採用率を表示する時、システムは提案の≥60%のユーザー採用率を達成する

### 要件5: ルール管理システム

**ユーザーストーリー:** コンテンツ管理者として、自分のスタイルガイドに応じて校正ルールをカスタマイズしたい。そうすることで、異なるコンテンツタイプ間で一貫した基準を維持できる。

#### 受け入れ基準

1. 設定画面で、システムは異なるルールセット間の切り替えを可能にする（ファイル選択）
2. 設定画面で、システムは個別ルールの有効/無効切り替えを可能にする
3. 設定画面で、システムはルールの重要度レベル変更を可能にする
4. ルールが更新された時、システムはアプリケーション再起動なしでホットリロードする
5. 問題を生成する時、システムは現在のルールセットID（例：ruleset@1.0.0）をすべての問題に付与する
6. ルール読み込みが失敗した時、システムはデフォルトルールにフォールバックし設定画面に警告を表示する

### 要件6: ローカルLLM統合

**ユーザーストーリー:** プライバシーを重視するユーザーとして、テキスト提案にローカルLLMサービスを使用したい。そうすることで、コンテンツを安全かつプライベートに保てる。

#### 受け入れ基準

1. LLM提案が有効な時、システムはローカルHTTP API経由でGemini 2.5 Flashに接続する
2. LLMを設定する時、システムは環境設定からベースURLとAPIキーの設定を可能にする
3. LLMに送信する時、システムは最小限の抜粋（2文以下）のみを送信する
4. LLMが利用できない時、システムはルールベース結果を維持しながらLLM固有のエラーを表示する
5. LLM提案が無効な時、システムは外部にデータを送信しない

### 要件7: ユーザーインターフェース・体験

**ユーザーストーリー:** ユーザーとして、SaaSダッシュボードのような直感的でモダンなインターフェースが欲しい。そうすることで、学習コストを最小限に抑えて効率的に文書校正できる。

#### 受け入れ基準

1. アプリケーションを使用する時、システムはDialin AIデザイン原則に従った余白の豊富なカードベースUIを提供する
2. メイン画面を表示する時、システムはヘッダー（アプリ名、解析ボタン、設定）、左テキストエリア、右問題リスト、右詳細パネルを表示する
3. テキストを表示する時、システムはメインテキストエリアに行番号付きの等幅フォントを使用する
4. 問題を表示する時、システムはアクセシビリティのため高コントラストの色とアイコン・ラベルを使用する
5. ユーザーが操作する時、システムは完全なキーボードナビゲーション（Tab/Enter/Space/Esc）をサポートする
6. ステータスを表示する時、システムはフッターに文字数、文数、解析時間、ルールセットIDを表示する
7. ビジュアルデザインを適用する時、システムはグレー背景に白カード、高コントラストテキスト、状態色（青=info、黄=warn、赤=error）を使用する

### 要件8: 設定・構成

**ユーザーストーリー:** ユーザーとして、解析動作とLLM設定を構成したい。そうすることで、自分のワークフローとプライバシー設定にアプリケーションをカスタマイズできる。

#### 受け入れ基準

1. 設定画面で、システムは解析トリガー（手動/自動）の選択を可能にする
2. 設定画面で、システムは文の長さ制限の設定を可能にする（デフォルト60文字）
3. 設定画面で、システムはLLM提案の有効/無効切り替えを可能にする
4. 設定画面で、システムはGeminiローカルAPIのベースURL、APIキー、タイムアウトの設定を可能にする
5. 設定画面で、システムは外部データ送信を防ぐプライバシートグルを提供する
6. 設定を保存する時、システムはクラウドストレージを使わずローカルに設定を永続化する

### 要件9: パフォーマンス・セキュリティ

**ユーザーストーリー:** ユーザーとして、コンテンツをプライベートに保つ高速で安全なテキスト解析が欲しい。そうすることで、プライバシーの心配なく効率的に作業できる。

#### 受け入れ基準

1. 2000文字を解析する時、システムはキャッシュを使用してルールのみの解析を1秒未満で完了する
2. テキストを保存する時、システムはコンテンツをローカルメモリのみに保持し、ディスクに永続化しない
3. LLMを使用する時、システムはユーザーが明示的にLLM提案を有効にした場合のみデータを送信する
4. APIキーを保存する時、システムは認証情報を安全なローカルストレージに保持し、UIからアクセス不可にする
5. ユーザーがコピーまたはダウンロードする時、システムは明示的なユーザーアクションでのみコンテンツを保存する

### 要件10: アクセシビリティ・国際化

**ユーザーストーリー:** アクセシビリティニーズを持つユーザーとして、キーボードとスクリーンリーダーで完全にアクセス可能なアプリケーションが欲しい。そうすることで、能力に関係なくすべての機能を使用できる。

#### 受け入れ基準

1. キーボードのみを使用する時、システムはマウスなしで完全な操作を可能にする
2. スクリーンリーダーを使用する時、システムは問題を読み取り可能なリスト形式で提示する
3. 重要度レベルを表示する時、システムは色覚障害者のアクセシビリティのため色+アイコン+ラベルの組み合わせを使用する
4. アニメーションを表示する時、システムは気を散らさない控えめなフェード/スライド遷移（150-200ms）を使用する
5. テキストを表示する時、システムは等幅フォントと可変幅フォント間の切り替えをサポートする