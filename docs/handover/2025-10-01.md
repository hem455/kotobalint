## kotobalint 引継ぎ資料 (2025/10/01)

### 今日のサマリ
- AI提案が安定稼働。LLM応答の行番号/余計な添字の除去（クレンジング）が効き、位置補正とスキーマ検証の失敗が減少。
- LLM失敗時は /api/suggest のフォールバック（200 + 空配列）でUIを維持。
- ルール通常解析は検出強化済み（食べれる、コンピュータ/コンピューター 等）。

### 実施内容（抜粋）
- LLM位置補正の強化: `CORRECTION_PATTERNS` + 近傍±50 で再スキャンし一致へスナップ（`src/lib/gemini-client.ts`）。
- LLM適用ポリシー: LLM提案はプレビュー専用（適用不可）。ルール由来のみ適用可（`src/lib/store.ts`, `src/components/IssueDetail.tsx`）。
- LLM失敗フォールバック: `/api/suggest` は 200 で空 issues を返す（`src/app/api/suggest/route.ts`）。
- ルール側調整: ら抜き言葉/表記ゆれの検出明確化（`src/rules/japanese-standard-rules.yaml`）。
- ルールテンプレ追加: `docs/rules/rule-template.yaml` を追加。

### うまくいった点
- LLM提案: 提案の生成・ハイライト位置の一致・UI劣化なし（失敗時もフォールバック）。
- 行番号など余計な記号の除去でスキーマ検証が安定。

### 次回やること
- LLM提案の rationale を短く（1〜2文）にトリミングするルールをプロンプト/ポストプロセスで導入。
- ルールセットの充実（言い換え/冗長表現/重複助詞/敬語の過不足 等）。テンプレに沿って追加し、影響度の高いものから有効化。
- ログ整備（requestId・elapsedMs を統一出力）。

### 手動テストメモ（抜粋）
- 通常解析: 「食べれる」「コンピュータ/コンピューター」で検出されること。
- LLM提案: 表示・位置一致・適用ボタンが出ない（プレビューのみ）。
- シークレット検知: 「免許番号 123456789012」はブロック、孤立した12桁は許可。
- 失敗時: /api/suggest が 200 + issues: [] を返し、UIは継続。

### 主要ファイル
- `src/lib/gemini-client.ts`, `src/app/api/suggest/route.ts`
- `src/lib/store.ts`, `src/components/IssueDetail.tsx`
- `src/rules/japanese-standard-rules.yaml`, `docs/rules/rule-template.yaml`


